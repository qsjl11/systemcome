# SystemCome 系统状态文档

## 系统概述
SystemCome是一个基于LLM的游戏系统，玩家扮演"系统"角色，通过与LLM驱动的主角互动来推进故事发展。游戏通过网页端进行交互，采用类似ChatGPT的对话形式。

## 当前系统架构

### 后端架构
1. Flask Web服务器 (flask_app/app.py)
   - 提供Web API接口
   - 支持普通对话和SSE流式对话
   - 处理用户输入和系统响应
   - 处理特殊指令（/task, /modify, /query等）

2. 核心包 (flask_app/core/)
   - System: 系统控制器，整合所有组件
   - Character: 主角代理，处理角色行为和状态
   - World: 世界模型，维护世界状态
   - Task: 任务对象，管理任务系统
   - LLMService: LLM服务，处理AI生成

### 前端架构
1. 网页界面 (flask_app/templates/chat.html)
   - 响应式设计
   - 支持移动端访问
   - Markdown渲染支持

2. 交互功能 (flask_app/static/script.js)
   - 对话管理（新建、切换、删除）
   - 实时消息流处理
   - 自动滚动和加载动画
   - 移动端菜单支持

## 当前实现功能
1. 基础对话系统
   - 支持多轮对话
   - 支持流式响应
   - 支持Markdown格式化
   
2. 对话管理
   - 创建新对话
   - 切换对话
   - 删除对话
   - 对话历史保存

3. 游戏核心机制
   - 系统能量值管理
   - 主角状态管理
   - 世界状态管理
   - 任务系统
   - 特殊指令支持

4. 主角AI实现
   - 性格系统
   - 决策系统
   - 行动系统
   - 心理活动系统

5. 世界系统
   - 世界状态一致性维护
   - 历史事件记录
   - 状态查询功能

## 待实现功能
1. 系统功能
   - 存档功能
   - 游戏设置
   - 系统状态展示
   - 任务管理界面

2. 优化
   - 实现真正的流式响应
   - 优化能量值计算
   - 增强任务影响机制
   - 改进故事生成质量

3. 界面功能
   - 添加能量值显示
   - 添加任务列表界面
   - 添加世界状态展示
   - 优化特殊指令输入

## 技术债务
1. 需要添加单元测试
2. 需要实现错误处理机制
3. 需要优化数据存储方案
4. 需要实现配置管理系统
5. 需要优化异步处理机制

## 最近更新
- 2024/1/31: 初始化系统文档
- 完成基础对话系统实现
- 完成前端界面基本功能
- 完成LLM服务集成
- 2024/1/31: 重构系统架构
  - 创建core包，实现核心类
  - 实现System控制器
  - 实现Character主角代理
  - 实现World世界模型
  - 实现Task任务系统
  - 优化LLM服务
  - 重构app.py，支持特殊指令
- 2024/1/31: 添加日志系统
  - 实现日志配置模块
  - 为所有核心类添加日志记录
  - 记录关键操作和错误信息
  - 支持按类分类的日志文件
  - 实现日志轮转和备份
- 2025/1/31: 添加故事配置系统
  - 创建story文件夹存放配置文件
  - 添加world_init.json定义世界初始状态
  - 添加character_init.json定义角色初始状态
  - 修改World类支持从配置文件加载初始状态
  - 修改Character类支持从配置文件加载初始状态
